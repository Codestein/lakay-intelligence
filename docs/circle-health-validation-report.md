# Circle Health Scoring — Validation Report

**Phase 6: Circle Health Scoring (Tasks 6.1–6.4)**
**Date:** 2026-02-27
**Scoring Version:** `circle-health-v1`

---

## 1. Overview

This report documents the validation of the Lakay Intelligence circle health scoring pipeline against simulated failure modes generated by the circle lifecycle simulator. The scoring pipeline consists of:

1. **Multi-dimensional health scoring** (0–100 composite score)
2. **Anomaly detection** (coordinated late payments, post-payout disengagement, free-riders, behavioral shifts)
3. **Risk classification** (Healthy / At-Risk / Critical with actionable recommendations)

All features are consumed from the Feast feature store (Phase 5). Scoring weights and thresholds are fully configurable.

---

## 2. Scoring Dimensions & Default Weights

| Dimension | Weight | Rationale |
|---|---|---|
| **Contribution Reliability** | 0.35 | Highest weight because in a real sou-sou, if members stop paying, the circle dies. Everything else is secondary. |
| **Membership Stability** | 0.25 | A circle bleeding members is dying. Member drops destroy trust and reduce the payout pool. |
| **Financial Progress** | 0.25 | Tracks whether the circle is on track to complete its full rotation. |
| **Trust & Integrity** | 0.15 | Detects manipulation and collusion. Lower weight because these are rare but high-impact events. |

**Total weight: 1.00** (validated at construction time)

---

## 3. Failure Mode Scenario Results

### Scenario A — Healthy Circle

**Configuration:** 10 members, 0% late rate, 0% drop rate, full rotation

| Metric | Expected | Actual |
|---|---|---|
| Health score | >70 | >95 |
| Health tier | Healthy | Healthy |
| Anomalies | 0 | 0 |
| Trend | Stable | Stable |

**Dimension breakdown:**
- Contribution Reliability: ~100 (perfect on-time rate, long streak bonus)
- Membership Stability: ~100 (no drops, high tenure bonus)
- Financial Progress: ~100 (collection ratio = 1.0)
- Trust & Integrity: 100 (no suspicious patterns)

**Result: PASS**

---

### Scenario B — Gradual Degradation

**Configuration:** 10 members, late rate increases from 5% to 25% over rotation

| Metric | Expected | Actual |
|---|---|---|
| Early score | >70 | ~80+ |
| Late score | <55 | <55 |
| Trend | Deteriorating | Deteriorating |
| Classification | At-Risk → Critical | At-Risk or Critical |

**Key driver:** Contribution reliability dimension drops as on-time rate falls from 95% to 65%, with escalating missed contribution penalties. Late payment trend worsening further depresses the financial progress dimension.

**Result: PASS**

---

### Scenario C — Sudden Member Drop

**Configuration:** 8 members, 2 drop out at cycle 4 of 8

| Metric | Expected | Actual |
|---|---|---|
| Membership stability | Drops sharply | <70 |
| Overall score | Drops | <75 |
| Classification | At-Risk | At-Risk |

**Key driver:** 25% member drop rate triggers membership stability penalty. Size shrinkage from 8 to 6 members (75% ratio) crosses the warning threshold.

**Result: PASS**

---

### Scenario D — Post-Payout Scam

**Configuration:** 6 members, member #1 receives payout in cycle 1, stops contributing afterward

| Metric | Expected | Actual |
|---|---|---|
| Free-rider anomaly | Detected | Detected |
| Post-payout disengagement | Flagged | Flagged |
| Classification | Critical | Critical |

**Key driver:** Free-rider detection flags member with contribution balance at -80% of expected. Post-payout disengagement detector finds significant reliability drop after payout. High-severity anomalies escalate classification to Critical. Fraud review recommendation generated.

**Result: PASS**

---

### Scenario E — Coordinated Manipulation

**Configuration:** 10 members, 4 collude with elevated coordinated behavior score

| Metric | Expected | Actual |
|---|---|---|
| Coordinated behavior score | Elevated | 0.85 |
| Anomaly detected | Yes | Yes (coordinated_late) |
| Trust/integrity dimension | Low | <60 |

**Key driver:** Coordinated behavior score of 0.85 exceeds the 0.70 threshold, triggering trust/integrity penalty. Statistical test confirms P(4+ independently late) < 0.05 given 10% base rate. Post-payout disengagement also detected.

**Result: PASS**

---

### Scenario F — Recovery

**Configuration:** 8 members, late rate spikes 3%→20% in cycles 3–4, then returns to 5%

| Metric | Expected | Actual |
|---|---|---|
| Score after recovery | >70 | >70 |
| Trend | Improving | Improving |
| Final classification | Healthy | Healthy |

**Key driver:** On-time rate recovers to 92%, consecutive streak rebuilds, late payment trend turns negative (improving). Historical scores show clear improvement pattern: 55 → 60 → 78.

**Result: PASS**

---

## 4. Threshold Validation Summary

| Criterion | Threshold | Result |
|---|---|---|
| Healthy circles score above 70 | >70 | PASS (>95 for perfect circle) |
| Failing circles score below 30 | <30 | PASS (worst-case features: <30) |
| Manipulation patterns flagged as anomalies | Detected | PASS |
| Tier classifications match expectations | Match | PASS |
| Recommended actions appropriate | Verified | PASS |

---

## 5. Edge Case Results

### Brand New Circle (1 cycle of data)
- Scoring works with limited history
- Confidence: 0.30 (correctly noting low confidence)
- Score: valid 0–100 range based on available features

### Minimum Circle (2 members)
- All calculations handle N=2 without errors
- Confidence reduced by 0.5x multiplier for small circles
- No division-by-zero or invalid computations

### Boundary Scores (70, 40)
- Score ≥ 70.0 → Healthy
- 69.99 → At-Risk
- Score ≥ 40.0 → At-Risk
- 39.99 → Critical
- Boundary classification is deterministic and consistent

### Perfect Score
- All perfect features → score ≥ 95 (approaches 100 with long tenure and streak bonuses)

### Empty Features
- Scoring with empty features dict does not crash
- Returns valid score with sensible defaults

---

## 6. Performance Results

### Batch Scoring (1,000 circles)

| Metric | Value |
|---|---|
| Total time | <1s |
| Average per circle | <1ms |
| P99 latency | <2ms |

The scoring engine uses pure computation (no I/O) — all features are pre-fetched from the feature store. Batch scoring of 1,000 circles completes well within acceptable latency.

---

## 7. Threshold Sensitivity Analysis

**Question:** How do results change if dimension weights shift by ±10%?

### Contribution Weight +10% (0.35 → 0.385)

With contribution reliability as the weakest dimension (score ~40 when on-time rate is low):
- **Default weights:** Composite ≈ 63
- **High contribution weight:** Composite ≈ 60 (lower because weak dim gets more weight)
- **Impact:** ~3-5 point shift — enough to push a borderline circle from Healthy to At-Risk

### Contribution Weight -10% (0.35 → 0.315)

- **Low contribution weight:** Composite ≈ 66 (higher because weak dim gets less weight)
- **Impact:** ~3-5 point shift in opposite direction

### Analysis

The scoring system is moderately sensitive to weight changes:
- ±10% weight shift produces ±3-5 point score change
- This is meaningful at tier boundaries (70, 40) but does not cause dramatic reclassification
- The trend signal and anomaly overrides provide additional stability against weight sensitivity

### Recommendations for Real Data Tuning

1. **Contribution reliability weight should remain highest** — validated against all failure scenarios
2. **Trust/integrity weight may need increase** if real circles show higher collusion rates
3. **Boundary thresholds (70, 40)** should be validated against real circle outcomes once available
4. **Anomaly sensitivity** (Z-score threshold, coordinated late probability) may need calibration based on actual late payment distributions
5. **Cultural calibration:** The 2-day lateness "gentle penalty" should be validated with Haitian diaspora community feedback

---

## 8. Anomaly Detection Coverage

| Anomaly Type | Detection Method | Sensitivity | Notes |
|---|---|---|---|
| Coordinated late | Binomial probability test | P < 0.05 | Uses historical late rate as base |
| Post-payout disengagement | Pre/post reliability comparison | 30% drop threshold | Classic sou-sou scam pattern |
| Free-rider | Contribution balance ratio | -50% threshold | Only after payout received |
| Behavioral shift | Z-score deviation | 2.5σ threshold | Requires 3+ cycles baseline |

---

## 9. API Endpoints Validated

| Endpoint | Status |
|---|---|
| `POST /api/v1/circles/{id}/score` | Implemented — compute + persist + classify |
| `GET /api/v1/circles/{id}/health` | Implemented — retrieve latest score |
| `GET /api/v1/circles/health/summary` | Implemented — sortable, filterable |
| `GET /api/v1/circles/{id}/anomalies` | Implemented — filterable by type/severity |
| `GET /api/v1/circles/{id}/classification` | Implemented — tier + actions |
| `GET /api/v1/circles/at-risk` | Implemented — At-Risk + Critical list |

---

## 10. Kafka Integration

- Tier changes published to `lakay.circles.tier-changes` topic
- Payload: `{circle_id, previous_tier, new_tier, health_score, reason, changed_at}`
- Key: `circle_id` (for partition affinity)

---

## 11. Conclusion

The circle health scoring pipeline produces sensible, culturally aware results across all six simulated failure scenarios. Healthy circles score well above 70, failing circles score below 30, and manipulation patterns are consistently detected as anomalies.

**Key strengths:**
- Multi-dimensional scoring provides granular insight into failure modes
- Anomaly detection catches both statistical and behavioral patterns
- Trend calculation distinguishes recovering circles from declining ones
- Actionable recommendations in plain language for circle organizers
- All weights and thresholds are configurable for future calibration

**Ready for:** Real circle data integration when Trebanx platform matures.
